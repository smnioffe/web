<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Rx Chart</title>.
		<link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
        <link href="css/nv.d3.min.css" rel="stylesheet" type="text/css">
        <script src="js/d3.v3.min.js"></script>
        <script src="js/nv.d3.min.js"></script>
		<script src="js/d3.tip.v0.6.3.js"></script>
		
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

	<link href='//fonts.googleapis.com/css?family=Roboto' type="text/css" rel="stylesheet" media="all"/>
	<link href='//fonts.googleapis.com/css?family=Roboto+Condensed:300,400,700' type="text/css" rel="stylesheet" media="all"/>
    <link href='//fonts.googleapis.com/css?family=Roboto:400,900italic,700italic,900,700,500italic,500,400italic,300italic,300,100italic,100' type="text/css" rel="stylesheet" media="all"/>
    <link href='//fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700' type="text/css" rel="stylesheet" media="all"/>
    <link href='//fonts.googleapis.com/css?family=Maven+Pro:400,500,700,900' type="text/css" rel="stylesheet" media="all"/>
    <link href='//fonts.googleapis.com/css?family=RobotoDraft:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en' rel='stylesheet' type='text/css'>
	<link href='//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css' type="text/css" rel="stylesheet" media="all"/>

	
	<script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/materialize/0.97.0/js/materialize.min.js"></script>

	<script src="js/lineChart.js"></script>
	<script src="js/pieChart.js"></script>
	<script src="js/barSummary.js"></script>
	

    </head>

<style>	
body {
  font: 10px sans-serif;
  font-family: 'Roboto', sans-serif;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.bar {
  fill: steelblue;
}

.x.axis path {
  display: none;
}

.line {
  fill: none;
  stroke: steelblue;
  stroke-width: 3.5px;
}

.arc path {
  stroke: #fff;
}

	span { 
	color: #FBB917;
	font-weight: bold;
	font-size: 16px;
	shadow: 2px 2px #FFFFFF;
	}
	
	
		strong { 
	font-size: 16px;
	}
	
	.d3-tip {
  line-height: 1;
  font-weight: bold;
  padding: 12px;
  background: rgba(0, 0, 0, 0.8);
  color: #fff;
  border-radius: 2px;
}

/* Creates a small triangle extender for the tooltip */
.d3-tip:after {
  box-sizing: border-box;
  display: inline;
  font-size: 10px;
  width: 100%;
  line-height: 1;
  color: rgba(0, 0, 0, 0.8);
  content: "\25BC";
  position: absolute;
  text-align: center;
}

/* Style northward tooltips differently */
.d3-tip.n:after {
  margin: -1px 0 0 0;
  top: 100%;
  left: 0;
}


p4 {
      font-family: 'Roboto', sans-serif;
      font-size: 18px;
	  text-align: right;
 
	 
    }
</style>
 <body onload="loadChart('Practice Setting','Insurance','Insurance Coverage','bar')">
<ul id="dropdownCategory" class="dropdown-content" >
  <li class="droptext" onclick="loadChart('Location','blank','blank','blank')"><a style="color:#696969;font-size: 14px;">Location</a></li>
  <li class="droptext" onclick="loadChart('Number of Years','blank','blank','blank')"><a style="color:#696969;font-size: 14px;">Number of Years</a></li>
  <li class="droptext" onclick="loadChart('Practice Setting','blank','blank','blank')"><a style="color:#696969;font-size: 14px;">Practice Setting</a></li>
  <li class="droptext" onclick="loadChart('Total Patients','blank','blank','blank')"><a style="color:#696969;font-size: 14px;">Total Patients</a></li>
</ul>


<ul id="dropdownDimension" class="dropdown-content">
  <li class="droptext" onclick="loadChart('blank','Prescription','Prescription Popularity','blank')"><a style="color:#696969;font-size: 14px;">Prescription Popularity</a></li>

  <li class="droptext" onclick="loadChart('blank','Factors','Medication Factors','blank')"><a style="color:#696969;font-size: 14px;">Medication Factors</a></li> 
  <li class="divider"></li>   
    <li class="droptext" onclick="loadChart('blank','Aware','Awareness','blank')"><a style="color:#696969;font-size: 14px;">Awareness</a></li>
  <li class="droptext" onclick="loadChart('blank','Efficacy','Efficacy','blank')"><a style="color:#696969;font-size: 14px;">Efficacy</a></li>
  <li class="droptext" onclick="loadChart('blank','Insurance','Insurance Coverage','blank')"><a style="color:#696969;font-size: 14px;">Insurance</a></li>
  <li class="droptext" onclick="loadChart('blank','Safety','Safety Tolerability','blank')"><a style="color:#696969;font-size: 14px;">Safety</a></li>
 <li class="divider"></li>   
 <li class="droptext" onclick="loadChart('blank','Cytogenetic','Cytogenetic Anamoly','pie')"><a style="color:#696969;font-size: 14px;">Cytogenetic Anamoly</a></li> 
  </ul>



  <nav class="grey darken-1" style=" position:absolute;	top:0px;">
    <div class="nav-wrapper" >
      <ul id="nav-mobile" class="left hide-on-med-and-down">
		
		<li id="geoTotal" onclick="powerpointClick()" ><a>Presentation<i class="material-icons right">slideshow</i></a></li>

		<li id="geoTotal" ><a class="dropdown-button" href="#!" data-activates="dropdownCategory">Category<i class="material-icons right">arrow_drop_down</i></a></li>
		<li id="geoTotal" ><a class="dropdown-button" href="#!" data-activates="dropdownDimension">Dimension<i class="material-icons right">arrow_drop_down</i></a></li>
		<li id="geoTotal" onclick="loadChart('blank','blank','blank','summary')" ><a>High vs Low Prescribers</a></li>
		<li id="geoTotal" ><a href="map.html">Geographic View<i class="material-icons right">language</i></a></li>
		<!-- <li id="geoTotal" onclick="loadChart('blank','blank','blank','line')"><a href="#!">Test</a></li> -->
	


      </ul>
    </div>
  </nav>
  
 
  <div id="pie0" style=" position:absolute;	left:-100px;	top:240px;	width:400px;	height:400px;";></div>
<div id="pie1"  style=" position:absolute;	left:100px;	top:240px;	width:400px;	height:400px;";></div>
<div id="pie2"   style=" position:absolute;	left:300px;	top:240px;	width:400px;	height:400px;";></div>
<div id="pie3"   style=" position:absolute;	left:500px;	top:240px;	width:400px;	height:400px;";></div>
<div id="pie4"   style=" position:absolute;	left:700px;	top:240px;	width:400px;	height:400px;";></div>
<div id="pie5"   style=" position:absolute;	left:900px;	top:240px;	width:400px;	height:400px;";></div>
<div id="pie6"   style=" position:absolute;	left:1100px;	top:240px;	width:400px;	height:400px;";></div>

<div id="pie0b" style=" position:absolute;	left:-100px;	top:440px;	width:400px;	height:400px;";></div>
<div id="pie1b"  style=" position:absolute;	left:100px;	top:440px;	width:400px;	height:400px;";></div>
<div id="pie2b"   style=" position:absolute;	left:300px;	top:440px;	width:400px;	height:400px;";></div>
<div id="pie3b"   style=" position:absolute;	left:500px;	top:440px;	width:400px;	height:400px;";></div>
<div id="pie4b"   style=" position:absolute;	left:700px;	top:440px;	width:400px;	height:400px;";></div>
<div id="pie5b"   style=" position:absolute;	left:900px;	top:440px;	width:400px;	height:400px;";></div>
<div id="pie6b"   style=" position:absolute;	left:1100px;	top:440px;	width:400px;	height:400px;";></div>

  <div id="mainChart" style=" position:absolute;	left:60px;	top:100px;	width:400px;	height:400px;";></div>		

      <div id="dynamicChart" style=" position:absolute;	left:300px;	top:100px;	width:400px;	height:400px;";></div>	

    <a onclick="loadChart('blank','blank','blank','bar')" id="barBt" class="btn-floating red lighten-2" style="top:135px; left:85px; position: absolute;">
      <i style="font-size: 22px;" class="fa fa-bar-chart"></i>
    </a> 
	
	<a onclick="loadChart('blank','blank','blank','line')" id="lineBt" class="btn-floating blue lighten-2" style="top:135px; left:135px; position: absolute;">
	<i style="font-size: 22px;" class="fa fa-line-chart"></i>
	</a>
	
	<a onclick="loadChart('blank','blank','blank','pie')" id="pieBt" class="btn-floating green lighten-2"  style="top:135px; left:185px; position: absolute;">
	<i style="font-size: 22px;" class="fa fa-pie-chart"></i>
	</a>
  

  
  
<p4  class="right-align" id="Title" style="top:120px; left:360px; position: absolute; margin-top: 0px; text-align: right;"></p4>	

<button id="groupedBt" onclick="loadChart('blank','blank','blank','lineG')" class="btn small blue-grey lighten-2 waves-effect waves-light"  style="top:800px; left:50px; position: absolute;" >Grouped
    
  </button>
  
<button id="linearBt" onclick="loadChart('blank','blank','blank','line')" class="btn small blue-grey lighten-2 waves-effect waves-light"  style="top:800px; left:200px; position: absolute;" >Linear
   
  </button>  

  
  <!-- Dropdown Trigger -->
  <a class='dropdown-button btn teal lighten-2' id='summaryBtn' href='#' data-activates='dropdown1' style="top:235px; left:100px; position: absolute;" >Categories</a>

  <!-- Dropdown Structure -->
  <ul id='dropdown1' class='dropdown-content'>
    <li id="convenience"><a style="color:#696969;font-size: 14px;">Convenience Importance</a></li>
    <li id="efficacy"><a style="color:#696969;font-size: 14px;">Efficacy Importance</a></li>
	<li id="safety"><a style="color:#696969;font-size: 14px;">Safety Importance</a></li>
	<li id="insurance"><a style="color:#696969;font-size: 14px;">Insurance Importance</a></li>
	<li class="divider"></li>
	 <li id="perceivedconvenience"><a style="color:#696969;font-size: 14px;">Perceived Convenience</a></li>
    <li id="perceivedefficacy"><a style="color:#696969;font-size: 14px;">Perceived Efficacy</a></li>
	<li id="perceivedsafety"><a style="color:#696969;font-size: 14px;">Perceived Safety</a></li>
	<li id="perceivedinsurance"><a style="color:#696969;font-size: 14px;">Perceived Insurance</a></li>
		<li class="divider"></li>
	<li id="totalpatients"><a style="color:#696969;font-size: 14px;">Total Patients</a></li>
	<li class="divider"></li>
	<li id="plasmotropincytogenetic"><a style="color:#696969;font-size: 14px;">Plasmotropin w/ Cytogenetic</a></li>
	<li id="plasmotropinwithoutcytogenetic"><a style="color:#696969;font-size: 14px;">Plasmotropin w/o Cytogenetic</a></li>
   <!--  -->
  </ul>
  
 <div style="top:100px; left:100px; position: absolute;"  id='powerpoint'> 
  <iframe src='https://onedrive.live.com/embed?cid=A5C0B07B1FD3977D&resid=A5C0B07B1FD3977D%2110291&authkey=AFJSIVPSfHPjpWQ&em=2&wdAr=1.7777777777777777' width='1186px' height='691px' frameborder='0'>
This is an embedded <a target='_blank' href='http://office.com'>Microsoft Office
</a> presentation, powered by <a target='_blank' href='http://office.com/webapps'>Office Online</a>.</iframe>
  </div>  
  
  
        
        <script>
		

		
var margin = {top: 150, right: 20, bottom: 140, left: 40},
    width = 960 - margin.left - margin.right,
    height = 700 - margin.top - margin.bottom;

function powerpointClick()
{
	 d3.selectAll("svg")
        .remove();
		$("#barBt").hide();
		$("#lineBt").hide();
		$("#pieBt").hide();
	$("#powerpoint").show();
}

		
	var categoryVarUpdated 
	var dimensionVarUpdated 
	var dimensionVarLabelUpdated 
	var chartTypeUpdated
	
 function loadChart(DimensionVar,CategoryVar,dimensionVarLabel,chartType){
	 	
		$("#barBt").show();
		$("#lineBt").show();
		$("#pieBt").show();
	 $("#powerpoint").hide();

console.log(DimensionVar,CategoryVar,categoryVarUpdated ,dimensionVarLabel,chartType,chartTypeUpdated)

//svg.selectAll("*").remove();
 d3.selectAll("svg")
        .remove();

var svg = d3.select('#mainChart').append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      
	

		   
  if (CategoryVar !== "blank"){
categoryVarUpdated= CategoryVar
dimensionVarLabelUpdated=dimensionVarLabel
}

	if (DimensionVar !== "blank"){
dimensionVarUpdated=DimensionVar
}

  if (chartType !== "blank"){
chartTypeUpdated= chartType 

}



if ((chartTypeUpdated=="line"||chartTypeUpdated=="lineG")&&(categoryVarUpdated!=="Prescription"&&categoryVarUpdated!=="Factors"&&categoryVarUpdated!=="Cytogenetic"))
{
	$("#groupedBt").show();
	$("#linearBt").show();
}
else {
	{
	$("#groupedBt").hide();
	$("#linearBt").hide();
}
}



if (chartTypeUpdated == "summary")
{$("#summaryBtn").show();} else
{$("#summaryBtn").hide();}

if (categoryVarUpdated!=="Cytogenetic"){
d3.select("#Title").text(dimensionVarLabelUpdated +" by "+dimensionVarUpdated);
}

if ((categoryVarUpdated=="Prescription"&&chartTypeUpdated !== "line")||(categoryVarUpdated=="Factors"&&chartTypeUpdated !== "line")||(categoryVarUpdated=="Cytogenetic"&&chartTypeUpdated !== "line"&& chartTypeUpdated!=="summary" )) 
{ console.log(2)
	$('#Title').css('left', '450px');
	
$("#lineBt").attr('class','btn-floating disabled');
$("#barBt").attr('class','btn-floating disabled');
$("#pieBt").attr('class','btn-floating green lighten-2');


loadPie(dimensionVarUpdated,categoryVarUpdated,dimensionVarLabelUpdated)

}

else if (chartTypeUpdated == "line"||chartTypeUpdated == "lineG"){
	
	$('#Title').css('left', '380px');
	
	
if (dimensionVarUpdated=="Location"||dimensionVarUpdated=="Practice Setting")
{ $("#lineBt").attr('class','btn-floating disabled');	
} else {$("#lineBt").attr('class','btn-floating blue lighten-2');}	
	
$("#barBt").attr('class','btn-floating red lighten-2');
$("#pieBt").attr('class','btn-floating disabled');


if ( $( "#lineBt" ).hasClass( "btn-floating blue lighten-2" ) ) {
 loadLineChart(dimensionVarUpdated,categoryVarUpdated,dimensionVarLabelUpdated,chartTypeUpdated)
}

else if ((categoryVarUpdated=="Prescription"||categoryVarUpdated=="Factors"||categoryVarUpdated=="Cytogenetic")&&chartTypeUpdated !== "summary")
{
	loadChart(DimensionVar,CategoryVar,dimensionVarLabel,'pie')
}
else {
		loadChart(DimensionVar,CategoryVar,dimensionVarLabel,'bar')
}

}
else if (chartTypeUpdated == "summary") { 
	$('#Title').css('left', '430px');
barSummary(dimensionVarUpdated,categoryVarUpdated,dimensionVarLabelUpdated,chartTypeUpdated)
chartTypeUpdated="bar"
}
else {
		$('#Title').css('left', '360px');

$("#barBt").attr('class','btn-floating red lighten-2');
$("#pieBt").attr('class','btn-floating disabled');
if (dimensionVarUpdated=="Location"||dimensionVarUpdated=="Practice Setting")
{ $("#lineBt").attr('class','btn-floating disabled');	
} else {$("#lineBt").attr('class','btn-floating blue lighten-2');}	

d3.csv("data/category3.csv", function(error, data) {
  if (error) throw error;

  var x0 = d3.scale.ordinal()
    .rangeRoundBands([0, width], .1);

var x1 = d3.scale.ordinal();

var y = d3.scale.linear()
    .range([height, 0]);

  var tip = d3.tip()
            .attr('class', 'd3-tip')
            .offset([-10, 0])
            .html(function(d) {
                return "<p2><strong>Name:</strong> <span>" + d.name + "</span></p2><br><strong>Value:</strong> <span>" + d.value + "</span>";
            });

        svg.call(tip);


		
var color = d3.scale.ordinal()
    .range(["#6D594A", "#CAC5B0", "#69A399", "#B8BFC6", "#8BA4B5"]);

var xAxis = d3.svg.axis()
    .scale(x0)
    .orient("bottom")
	;

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
	.ticks(7)
    .tickFormat(d3.format(".0f'"));


  var categoryNames = d3.keys(data[0]).filter(function(key) { return key !== "type" & key !== "dimension"  & key !== "category" & key !== "n"; }).sort();
  
    var dataFiltered = data.filter(function(d){ return d.dimension==dimensionVarUpdated && d.category==categoryVarUpdated});

 
  
  dataFiltered.forEach(function(d) {
	d.date = d.type;
	d.nVar=d.n;
    d.ages = categoryNames.map(function(name) { return {name: name, value: +d[name]}; }).sort();
  });

  x0.domain(dataFiltered.map(function(d) { return d.type; }));
  x1.domain(categoryNames).rangeRoundBands([0, x0.rangeBand()]);
  y.domain([0, d3.max(dataFiltered, function(d) { return d3.max(d.ages, function(d) { return d.value; }); })]);

  svg.append("g")   
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
	  //.attr("transform", "rotate(-65)" )
	  .attr("font-size",12)
      .call(xAxis) .selectAll("text")  
            .style("text-anchor", "end")
            .attr("dx", "-.8em")
            .attr("dy", ".15em")
            .attr("transform", "rotate(-45)" );
			
			
	

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("Rating");

  var medication = svg.selectAll(".medication")
      .data(dataFiltered)
    .enter().append("g")
      .attr("class", "g")
	  .attr("transform", "rotate(-65)" )
      .attr("transform", function(d) { return "translate(" + x0(d.type) + ",0)"; });



  medication.selectAll("rect")
      .data(function(d) { return d.ages; })
    .enter().append("rect")
      .attr("width", x1.rangeBand())
      .attr("x", function(d) { return x1(d.name); })
      .attr("y", 410)
	   .attr("height", 0)
    .style("fill", function(d) { return color(d.name); })
	 .on("mouseover", synchronizedMouseOver)
            .on("mouseout", synchronizedMouseOut) ;
       // .on("mouseover", function(){               
           // tip.show(d);        
       // }).on("mouseout", function(){
           // tip.hide(d);         
       // });	  
	   
	   // .attr("y", function(d) { return y(d.value); })
      // .attr("height", function(d) { return height- y(d.value) ; })
	   

  medication.selectAll("rect")
      .data(function(d) { return d.ages; })
    .transition(800)//.enter().append("rect")
	.ease("quad")
    
	    .attr("y", function(d) { return y(d.value); })
      .attr("height", function(d) { return height- y(d.value) ; })
      .style("fill", function(d) { return color(d.name); });
	   
       // .on("mouseover", function(){               
           // d3.select(this).transition(200)         
               // .style("fill-opacity",.5);          
       // }).on("mouseout", function(){
           // d3.select(this).transition(200)
               // .style("fill-opacity",1);           
       // });


	  

  var legend = svg.selectAll(".legend")
      .data(categoryNames)
    .enter().append("g")
      .attr("class", "legend")
      .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

  legend.append("rect")
      .attr("x", width - 18)
	  .attr("y", -120)
      .attr("width", 18)
      .attr("height", 18)
      .style("fill", color);

  legend.append("text")
      .attr("x", width - 24)
      .attr("y", -112)
      .attr("dy", ".35em")
      .style("text-anchor", "end")
      .text(function(d) { return d; });
	  
  function synchronizedMouseOver(d) {
            tip.show(d);
				d3.select(this).transition(200)
               .style(
			   "fill-opacity",.6);
        }

        function synchronizedMouseOut(d) {
            tip.hide(d);
			d3.select(this).transition(200)
               .style(
			   "fill-opacity",1);
        }
	  
	  
	  
	  
	});	
	

  // function synchronizedMouseOver(d) {
            // tip.show(d);
        // }

        // function synchronizedMouseOut(d) {
            // tip.hide(d);
        // }
	
		
};
 }	
		
		
		 $('.dropdown-button').dropdown({
      inDuration: 300,
      outDuration: 225,
      constrain_width: false, // Does not change width of dropdown to that of the activator
      hover: true, // Activate on hover
      gutter: 0, // Spacing from edge
      belowOrigin: true, // Displays dropdown below the button
      alignment: 'left' // Displays dropdown with edge aligned to the left of button
    }
  );
      
		
		</script>
		
		
		<script>
  // (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  // (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  // m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  // })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  // ga('create', 'UA-33501292-2', 'auto');
  // ga('send', 'pageview');

</script>
		
    </body>
</html>